<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Doofenshmirtz Evil Incorporated - City Simulator: Server.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Doofenshmirtz Evil Incorporated - City Simulator
   </div>
   <div id="projectbrief">The City Builder Simulation is a C++ project where users manage and develop various aspects of an evolving city. The simulation balances resources, infrastructure, and the needs of citizens while demonstrating principles of software design, such as scalability, flexibility, and maintainability.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Server.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="Server_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#ifndef SERVER_H</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#define SERVER_H</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;boost/beast/core.hpp&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;boost/beast/websocket.hpp&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;boost/asio.hpp&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;atomic&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;nlohmann/json.hpp&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="WebSocketNotifier_8h.html">WebSocketNotifier.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">namespace </span>beast = boost::beast;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">namespace </span>websocket = beast::websocket;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">namespace </span>net = boost::asio;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">using</span> tcp = net::ip::tcp;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="classServer.html">   35</a></span>&#160;<span class="keyword">class </span><a class="code" href="classServer.html">Server</a> : <span class="keyword">public</span> std::enable_shared_from_this&lt;Server&gt;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;{</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="classServer.html#a8c54645c9c065549fca2c46caa20fd35">   44</a></span>&#160;    <a class="code" href="classServer.html#a8c54645c9c065549fca2c46caa20fd35">Server</a>(<span class="keywordtype">int</span> &amp;taxRate) : io_context_(), acceptor_(io_context_), ws_stream_(), running_(false), taxRate_(taxRate) {}</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keyword">virtual</span> <a class="code" href="classServer.html#a4b3aa2579cb1c8cd1d069582c14d0fa6">~Server</a>();</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classServer.html#a7eac07d2582fa01c2671362efa955b31">start</a>();</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classServer.html#a07c45a7e101a3926d8f9685c3c5d14e4">stop</a>();</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classServer.html#a9294c3527b198d5afc02413acb1b6ae3">handleSession</a>(tcp::socket socket);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classServer.html#ad81573c94aca3996029ae9a7de064ee2">write</a>(<span class="keyword">const</span> nlohmann::json &amp;request);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classServer.html#ab283c97699a9a4acbd2e377ec974c5cc">setStartFlag</a>(std::atomic&lt;bool&gt; *flag);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classServer.html#aefa049ad00bf95ff1c3e22b3157b6583">setStopFlag</a>(std::atomic&lt;bool&gt; *flag);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classServer.html#af77b72ed8e2c87920829f1f3903fcc3e">setEducationFlag</a>(std::atomic&lt;bool&gt; *flag);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classServer.html#a1353947b67c99a4ece4bfef2b0cd8840">setWorkFlag</a>(std::atomic&lt;bool&gt; *flag);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classServer.html#a9b32be2410177048e35cda551964fe1c">setTaxFlag</a>(std::atomic&lt;bool&gt; *flag);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    net::io_context io_context_; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    tcp::acceptor acceptor_; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    std::shared_ptr&lt;websocket::stream&lt;tcp::socket&gt;&gt; ws_stream_;  </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    std::atomic&lt;bool&gt; running_; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    std::atomic&lt;bool&gt; *startFlag_; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    std::atomic&lt;bool&gt; *stopFlag_; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    std::mutex mutex_; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    std::atomic&lt;bool&gt; *EducationFlag_; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    std::atomic&lt;bool&gt; *ShortWorkFlag_; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    std::atomic&lt;bool&gt; *TaxFlag_; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordtype">int</span> &amp;taxRate_;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;};</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="ttc" id="aWebSocketNotifier_8h_html"><div class="ttname"><a href="WebSocketNotifier_8h.html">WebSocketNotifier.h</a></div><div class="ttdoc">Defines the WebSocketNotifier class.</div></div>
<div class="ttc" id="aclassServer_html"><div class="ttname"><a href="classServer.html">Server</a></div><div class="ttdoc">WebSocket server class that handles client connections and message processing.</div><div class="ttdef"><b>Definition:</b> Server.h:36</div></div>
<div class="ttc" id="aclassServer_html_a07c45a7e101a3926d8f9685c3c5d14e4"><div class="ttname"><a href="classServer.html#a07c45a7e101a3926d8f9685c3c5d14e4">Server::stop</a></div><div class="ttdeci">void stop()</div><div class="ttdoc">Stop the WebSocket server.</div><div class="ttdef"><b>Definition:</b> Server.cpp:124</div></div>
<div class="ttc" id="aclassServer_html_a1353947b67c99a4ece4bfef2b0cd8840"><div class="ttname"><a href="classServer.html#a1353947b67c99a4ece4bfef2b0cd8840">Server::setWorkFlag</a></div><div class="ttdeci">void setWorkFlag(std::atomic&lt; bool &gt; *flag)</div><div class="ttdoc">Set the flag that will be triggered by the 'shortwork' command.</div><div class="ttdef"><b>Definition:</b> Server.cpp:17</div></div>
<div class="ttc" id="aclassServer_html_a4b3aa2579cb1c8cd1d069582c14d0fa6"><div class="ttname"><a href="classServer.html#a4b3aa2579cb1c8cd1d069582c14d0fa6">Server::~Server</a></div><div class="ttdeci">virtual ~Server()</div><div class="ttdoc">Destroy the Server object.</div><div class="ttdef"><b>Definition:</b> Server.cpp:9</div></div>
<div class="ttc" id="aclassServer_html_a7eac07d2582fa01c2671362efa955b31"><div class="ttname"><a href="classServer.html#a7eac07d2582fa01c2671362efa955b31">Server::start</a></div><div class="ttdeci">void start()</div><div class="ttdoc">Start the WebSocket server.</div><div class="ttdef"><b>Definition:</b> Server.cpp:94</div></div>
<div class="ttc" id="aclassServer_html_a8c54645c9c065549fca2c46caa20fd35"><div class="ttname"><a href="classServer.html#a8c54645c9c065549fca2c46caa20fd35">Server::Server</a></div><div class="ttdeci">Server(int &amp;taxRate)</div><div class="ttdoc">Construct a new Server object.</div><div class="ttdef"><b>Definition:</b> Server.h:44</div></div>
<div class="ttc" id="aclassServer_html_a9294c3527b198d5afc02413acb1b6ae3"><div class="ttname"><a href="classServer.html#a9294c3527b198d5afc02413acb1b6ae3">Server::handleSession</a></div><div class="ttdeci">void handleSession(tcp::socket socket)</div><div class="ttdoc">Handle an individual client session.</div><div class="ttdef"><b>Definition:</b> Server.cpp:33</div></div>
<div class="ttc" id="aclassServer_html_a9b32be2410177048e35cda551964fe1c"><div class="ttname"><a href="classServer.html#a9b32be2410177048e35cda551964fe1c">Server::setTaxFlag</a></div><div class="ttdeci">void setTaxFlag(std::atomic&lt; bool &gt; *flag)</div><div class="ttdoc">Set the flag that will be triggered by the 'tax' command.</div><div class="ttdef"><b>Definition:</b> Server.cpp:18</div></div>
<div class="ttc" id="aclassServer_html_ab283c97699a9a4acbd2e377ec974c5cc"><div class="ttname"><a href="classServer.html#ab283c97699a9a4acbd2e377ec974c5cc">Server::setStartFlag</a></div><div class="ttdeci">void setStartFlag(std::atomic&lt; bool &gt; *flag)</div><div class="ttdoc">Set the flag that will be triggered by the 'start' command.</div><div class="ttdef"><b>Definition:</b> Server.cpp:14</div></div>
<div class="ttc" id="aclassServer_html_ad81573c94aca3996029ae9a7de064ee2"><div class="ttname"><a href="classServer.html#ad81573c94aca3996029ae9a7de064ee2">Server::write</a></div><div class="ttdeci">virtual void write(const nlohmann::json &amp;request)</div><div class="ttdoc">Send a JSON message to the connected client.</div><div class="ttdef"><b>Definition:</b> Server.cpp:156</div></div>
<div class="ttc" id="aclassServer_html_aefa049ad00bf95ff1c3e22b3157b6583"><div class="ttname"><a href="classServer.html#aefa049ad00bf95ff1c3e22b3157b6583">Server::setStopFlag</a></div><div class="ttdeci">void setStopFlag(std::atomic&lt; bool &gt; *flag)</div><div class="ttdoc">Set the flag that will be triggered by the 'stop' command.</div><div class="ttdef"><b>Definition:</b> Server.cpp:15</div></div>
<div class="ttc" id="aclassServer_html_af77b72ed8e2c87920829f1f3903fcc3e"><div class="ttname"><a href="classServer.html#af77b72ed8e2c87920829f1f3903fcc3e">Server::setEducationFlag</a></div><div class="ttdeci">void setEducationFlag(std::atomic&lt; bool &gt; *flag)</div><div class="ttdoc">Set the flag that will be triggered by the 'education' command.</div><div class="ttdef"><b>Definition:</b> Server.cpp:16</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
